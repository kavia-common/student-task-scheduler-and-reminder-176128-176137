{"is_source_file": true, "format": "Python", "description": "This file provides database access and management functions for a task scheduling and reminder application. It implements schema creation, connection handling, task CRUD operations, category listing, and reminder management using SQLite.", "external_files": ["./settings"], "external_methods": ["get_settings"], "published": ["create_task", "update_task", "delete_task", "get_task", "list_tasks", "list_categories", "count_open_tasks", "count_due_today", "count_pomodoro_today", "get_due_unsent_reminders", "mark_reminder_sent"], "classes": [], "methods": [{"name": "str get_db_path()", "description": "Returns the file path to the SQLite database, ensuring the data directory exists.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection _get_connection()", "description": "Provides a thread-local SQLite connection, creating one if necessary, with foreign keys enabled.", "scope": "", "scopeKind": ""}, {"name": "Generator[sqlite3.Cursor,None,None] get_cursor()", "description": "Context manager that yields a cursor from the current thread's database connection.", "scope": "", "scopeKind": ""}, {"name": "None init_db()", "description": "Initializes the database schema once per process, creating necessary tables and indexes.", "scope": "", "scopeKind": ""}, {"name": "Optional[int] _get_or_create_category(cur: sqlite3.Cursor, name: Optional[str])", "description": "Inserts a category if it doesn't exist and returns its ID.", "scope": "", "scopeKind": ""}, {"name": "None _upsert_initial_reminder(cur: sqlite3.Cursor, task_id: int, due_iso: Optional[str])", "description": "Creates or updates an initial reminder for a task based on its due date.", "scope": "", "scopeKind": ""}, {"name": "int create_task( title: str, description: str = \"\", category_name: Optional[str] = None, priority: int = 2, estimated_minutes: int = 0, due_datetime: Optional[str] = None, status: str = \"open\", recurrence: str = \"none\", recurrence_end_date: Optional[str] = None, )", "description": "Creates a new task with provided attributes and sets up an initial reminder.", "scope": "", "scopeKind": ""}, {"name": "None update_task( task_id: int, title: str, description: str, category_name: Optional[str], priority: int, estimated_minutes: int, due_datetime: Optional[str], status: str, recurrence: str, recurrence_end_date: Optional[str], )", "description": "Updates an existing task's attributes and its associated reminder.", "scope": "", "scopeKind": ""}, {"name": "None delete_task(task_id: int)", "description": "Deletes a task (cascading to reminders).", "scope": "", "scopeKind": ""}, {"name": "Optional[Dict[str,Any]] get_task(task_id: int)", "description": "Retrieves a task by ID, including its category name.", "scope": "", "scopeKind": ""}, {"name": "List[Dict[str,Any]] list_tasks( limit: int = 200, status: Optional[str] = None, category: Optional[str] = None, priority_min: Optional[int] = None, priority_max: Optional[int] = None, date_range: Optional[Tuple[str, str]] = None, search: Optional[str] = None, )", "description": "Returns a list of tasks filtered by various criteria and supports search.", "scope": "", "scopeKind": ""}, {"name": "List[str] list_categories()", "description": "Returns a list of all category names.", "scope": "", "scopeKind": ""}, {"name": "int count_open_tasks()", "description": "Counts the number of tasks not marked as completed.", "scope": "", "scopeKind": ""}, {"name": "int count_due_today()", "description": "Counts tasks due on the current day.", "scope": "", "scopeKind": ""}, {"name": "int count_pomodoro_today()", "description": "Counts pomodoro sessions started today.", "scope": "", "scopeKind": ""}, {"name": "List[Dict[str,Any]] get_due_unsent_reminders(now_iso: str)", "description": "Retrieves reminders scheduled at or before the given timestamp that have not been sent yet.", "scope": "", "scopeKind": ""}, {"name": "None mark_reminder_sent(reminder_id: int)", "description": "Marks a specific reminder as sent.", "scope": "", "scopeKind": ""}], "calls": ["os.makedirs", "sqlite3.connect", "sqlite3.Row", "get_settings", "datetime.fromisoformat", "cur.execute", "cur.fetchall", "cur.fetchone", "cur.lastrowid"], "search-terms": ["task database", "task creation", "reminders", "task CRUD", "sqlite schema", "task_scheduler", "task categories", "initial reminder", "thread-local connection"], "state": 2, "file_id": 6, "knowledge_revision": 30, "git_revision": "575e0b4dbc8a9efcbb138dcac9a54cec9b28f478", "revision_history": [{"13": ""}, {"24": "ba4a713186061856c5a4d88414666dd1bbc3d686"}, {"26": "ba4a713186061856c5a4d88414666dd1bbc3d686"}, {"27": "ba4a713186061856c5a4d88414666dd1bbc3d686"}, {"28": "ba4a713186061856c5a4d88414666dd1bbc3d686"}, {"30": "575e0b4dbc8a9efcbb138dcac9a54cec9b28f478"}], "ctags": [{"_type": "tag", "name": "_db_initialized", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^_db_initialized = False$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_get_connection", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def _get_connection() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_or_create_category", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def _get_or_create_category(cur: sqlite3.Cursor, name: Optional[str]) -> Optional[int]:$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "function", "signature": "(cur: sqlite3.Cursor, name: Optional[str])"}, {"_type": "tag", "name": "_init_lock", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^_init_lock = threading.Lock()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_thread_local", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^_thread_local = threading.local()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_upsert_initial_reminder", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def _upsert_initial_reminder(cur: sqlite3.Cursor, task_id: int, due_iso: Optional[str]) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(cur: sqlite3.Cursor, task_id: int, due_iso: Optional[str])"}, {"_type": "tag", "name": "count_due_today", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def count_due_today() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "count_open_tasks", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def count_open_tasks() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "count_pomodoro_today", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def count_pomodoro_today() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "create_task", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def create_task($/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "( title: str, description: str = \"\", category_name: Optional[str] = None, priority: int = 2, estimated_minutes: int = 0, due_datetime: Optional[str] = None, status: str = \"open\", recurrence: str = \"none\", recurrence_end_date: Optional[str] = None, )"}, {"_type": "tag", "name": "delete_task", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def delete_task(task_id: int) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(task_id: int)"}, {"_type": "tag", "name": "get_cursor", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def get_cursor() -> Generator[sqlite3.Cursor, None, None]:$/", "language": "Python", "typeref": "typename:Generator[sqlite3.Cursor,None,None]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_db_path", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def get_db_path() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_due_unsent_reminders", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def get_due_unsent_reminders(now_iso: str) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "(now_iso: str)"}, {"_type": "tag", "name": "get_task", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def get_task(task_id: int) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "function", "signature": "(task_id: int)"}, {"_type": "tag", "name": "init_db", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def init_db() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "list_categories", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def list_categories() -> List[str]:$/", "language": "Python", "typeref": "typename:List[str]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "list_tasks", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def list_tasks($/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "( limit: int = 200, status: Optional[str] = None, category: Optional[str] = None, priority_min: Optional[int] = None, priority_max: Optional[int] = None, date_range: Optional[Tuple[str, str]] = None, search: Optional[str] = None, )"}, {"_type": "tag", "name": "mark_reminder_sent", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def mark_reminder_sent(reminder_id: int) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(reminder_id: int)"}, {"_type": "tag", "name": "update_task", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def update_task($/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "( task_id: int, title: str, description: str, category_name: Optional[str], priority: int, estimated_minutes: int, due_datetime: Optional[str], status: str, recurrence: str, recurrence_end_date: Optional[str], )"}], "hash": "46fa00fb14cdd742d1250e60c83d18c1", "format-version": 4, "code-base-name": "task_scheduler_backend", "filename": "task_scheduler_backend/streamlit_app/db.py", "fields": [{"name": "_db_initialized = False", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_init_lock = threading.Lock()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_thread_local = threading.local()", "scope": "", "scopeKind": "", "description": "unavailable"}]}