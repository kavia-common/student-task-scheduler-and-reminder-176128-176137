{"is_source_file": true, "format": "Python", "description": "This file provides database management utilities for a task scheduler and reminder application. It handles database initialization, connection management, and CRUD operations for tasks, categories, reminders, and related entities using SQLite.", "external_files": ["from .settings import get_settings"], "external_methods": ["get_settings"], "published": ["get_db_path", "get_cursor", "init_db", "add_task", "list_tasks", "count_open_tasks", "count_due_today", "count_pomodoro_today", "get_due_unsent_reminders", "mark_reminder_sent"], "classes": [], "methods": [{"name": "str get_db_path()", "description": "Returns the database file path, creating necessary directories based on settings.", "scope": "", "scopeKind": ""}, {"name": "sqlite3.Connection _get_connection()", "description": "Creates or retrieves a thread-local SQLite connection with foreign key enforcement.", "scope": "", "scopeKind": ""}, {"name": "Generator[sqlite3.Cursor,None,None] get_cursor()", "description": "Context manager that yields a cursor for the current thread's database connection.", "scope": "", "scopeKind": ""}, {"name": "None init_db()", "description": "Initializes the database schema once per process, creating necessary tables and indexes.", "scope": "", "scopeKind": ""}, {"name": "Optional[int] _get_or_create_category(cur: sqlite3.Cursor, name: Optional[str])", "description": "Inserts a category if it doesn't exist and returns its ID.", "scope": "", "scopeKind": ""}, {"name": "int add_task(title: str, description: str = \"\", category_name: Optional[str] = None, due_date: Optional[date] = None)", "description": "Inserts a new task with optional category and due date, returns task ID.", "scope": "", "scopeKind": ""}, {"name": "List[Dict[str,Any]] list_tasks(limit: int = 50)", "description": "Retrieves a list of tasks with their categories, limited by the given number.", "scope": "", "scopeKind": ""}, {"name": "int count_open_tasks()", "description": "Counts tasks that are not yet completed.", "scope": "", "scopeKind": ""}, {"name": "int count_due_today()", "description": "Counts tasks that are due today and not yet completed.", "scope": "", "scopeKind": ""}, {"name": "int count_pomodoro_today()", "description": "Counts pomodoro sessions started today.", "scope": "", "scopeKind": ""}, {"name": "List[Dict[str,Any]] get_due_unsent_reminders(now_iso: str)", "description": "Retrieves reminders that are due or overdue and not yet sent.", "scope": "", "scopeKind": ""}, {"name": "None mark_reminder_sent(reminder_id: int)", "description": "Marks a reminder as sent in the database.", "scope": "", "scopeKind": ""}], "calls": ["os.makedirs", "get_settings", "sqlite3.connect", "conn.execute", "conn.cursor", "cur.execute", "cur.executescript", "cur.fetchone", "cur.fetchall", "cur.lastrowid", "cur.close"], "search-terms": ["sqlite3", "database schema", "task management", "reminder system", "thread-local connection", "initialization lock"], "state": 2, "file_id": 6, "knowledge_revision": 13, "git_revision": "", "ctags": [{"_type": "tag", "name": "_db_initialized", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^_db_initialized = False$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_get_connection", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def _get_connection() -> sqlite3.Connection:$/", "language": "Python", "typeref": "typename:sqlite3.Connection", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "_get_or_create_category", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def _get_or_create_category(cur: sqlite3.Cursor, name: Optional[str]) -> Optional[int]:$/", "language": "Python", "typeref": "typename:Optional[int]", "kind": "function", "signature": "(cur: sqlite3.Cursor, name: Optional[str])"}, {"_type": "tag", "name": "_init_lock", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^_init_lock = threading.Lock()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "_thread_local", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^_thread_local = threading.local()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "add_task", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def add_task(title: str, description: str = \"\", category_name: Optional[str] = None, due_date: O/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "(title: str, description: str = \"\", category_name: Optional[str] = None, due_date: Optional[date] = None)"}, {"_type": "tag", "name": "count_due_today", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def count_due_today() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "count_open_tasks", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def count_open_tasks() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "count_pomodoro_today", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def count_pomodoro_today() -> int:$/", "language": "Python", "typeref": "typename:int", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_cursor", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def get_cursor() -> Generator[sqlite3.Cursor, None, None]:$/", "language": "Python", "typeref": "typename:Generator[sqlite3.Cursor,None,None]", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_db_path", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def get_db_path() -> str:$/", "language": "Python", "typeref": "typename:str", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "get_due_unsent_reminders", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def get_due_unsent_reminders(now_iso: str) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "(now_iso: str)"}, {"_type": "tag", "name": "init_db", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def init_db() -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "list_tasks", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def list_tasks(limit: int = 50) -> List[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:List[Dict[str,Any]]", "kind": "function", "signature": "(limit: int = 50)"}, {"_type": "tag", "name": "mark_reminder_sent", "path": "/home/kavia/workspace/code-generation/student-task-scheduler-and-reminder-176128-176137/task_scheduler_backend/streamlit_app/db.py", "pattern": "/^def mark_reminder_sent(reminder_id: int) -> None:$/", "language": "Python", "typeref": "typename:None", "kind": "function", "signature": "(reminder_id: int)"}], "hash": "38c71c5bd917877ed3460f8affcb8983", "format-version": 4, "code-base-name": "task_scheduler_backend", "filename": "task_scheduler_backend/streamlit_app/db.py", "fields": [{"name": "_db_initialized = False", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_init_lock = threading.Lock()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "_thread_local = threading.local()", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"13": ""}]}